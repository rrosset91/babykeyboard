/**
 * @description       : 
 * @author            : 
 * @group             : 
 * @last modified on  : 01-02-2021
 * @last modified by  : Felipe Ducheiko
 * Modifications Log 
 * Ver   Date         Author            Modification
**/
@isTest
public with sharing class FinancialBondsNotIssuedTest {

    // @note  83484 - Dados "Itens Títulos Não Emitidos"
    @TestSetup
    static void makeData(){
        ServiceParameter__c customSetting = new ServiceParameter__c();
        customSetting.name = 'GetBillDebts';
        customSetting.EndPoint__c = 'GetBillDebts';
        customSetting.Method__c = 'GET';
        customSetting.Timeout__c = 120;
        insert customSetting;
	}
	
    @IsTest
    static void testMethodGetBillDebts(){
		
		Test.setMock(HttpCalloutMock.class, new Mock());
		
        Test.startTest();
        FinancialBondsNotIssued.ResponseWrapper result = FinancialBondsNotIssued.getBillDebts('xpto', '123241', '', '');
		Test.stopTest();
		
		System.assertNotEquals(null, result);
		System.assertEquals(200, result.responseCode);
	}
	
	private class Mock implements HttpCalloutMock {
        public HTTPResponse respond(HTTPRequest req) {
			HTTPResponse res = new HTTPResponse();
            if (req.getEndpoint().startsWith('GetBillDebts')) {
                res.setBody('{"apiVersion":"1;2020-08-07","transactionId":"2ed61668-6d93-43e1-965b-3eb5a761b616","data":{"partnerDebts":[{"partnerId":1,"partnerName":"NET","chargeId":152022339,"generationDate":"2019-12-22T00:00:00Z","originalDueDate":"2020-01-10T00:00:00Z","dueDate":"2020-01-10T00:00:00Z","amountCharge":135.52,"amountPaid":null,"balance":135.52,"isExternalCollecting":null,"statusId":9,"status":"NAO EMITIDO","chargeModality":"DEBITO EM CONTA","serviceGroup":null,"debtGroup":[{"groupId":13,"groupDescription":"Mensalidade NET TV","amount":"105.34","order":"2","extractItems":[{"idExtractItem":1007168370,"idExtractItemType":"452","itemDescription":"ALUGUEL DE EQUIP HABILITADO","installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-01T00:00:00Z","sourceValue":0,"addressComplement":null,"pointId":7459074,"productId":17502,"productDescription":"ESSENCIAL DIG PA GR FID 17502","order":2,"itemGrouper":null,"proportionality":[{"entryDate":"2019-10-25T00:00:00Z","finishDate":"2019-11-01T00:00:00Z","quantity":1,"amount":23.33,"amountDiscount":0,"message":"DE 25/10 A 31/10 ( 7 ): R$ 23.33 23.3%"}]},{"idExtractItem":1007168382,"idExtractItemType":"2","itemDescription":"MENSALIDADE TV PRINCIPAL","installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-01T00:00:00Z","sourceValue":105.34,"addressComplement":null,"pointId":7459073,"productId":30009,"productDescription":"ESSENCIAL DIG FID 30009","order":1,"itemGrouper":null,"proportionality":null}]},{"groupId":22,"groupDescription":"Mensalidade Proporcional TV","amount":"1.55","order":"3","extractItems":[{"idExtractItem":1007168376,"idExtractItemType":"103","itemDescription":"MENS PROPORCIONAL TV PRINCIPAL","installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-01T00:00:00Z","sourceValue":-35.11,"addressComplement":null,"pointId":7459073,"productId":30009,"productDescription":"TOP HD MULTI FIDELIDADE","order":3,"itemGrouper":null,"proportionality":[{"entryDate":"2019-12-22T00:00:00Z","finishDate":"2020-01-01T00:00:00Z","quantity":-1,"amount":-35.11,"amountDiscount":0,"message":"DE 22/12 A 31/12 ( 10 ): R$ -35.11 33.3%"}]},{"idExtractItem":1007168395,"idExtractItemType":"103","itemDescription":"MENS PROPORCIONAL TV PRINCIPAL","installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-01T00:00:00Z","sourceValue":36.66,"addressComplement":null,"pointId":7459073,"productId":51369,"productDescription":"TOP HD MULTI FIDELIDADE","order":3,"itemGrouper":null,"proportionality":[{"entryDate":"2019-12-22T00:00:00Z","finishDate":"2020-01-01T00:00:00Z","quantity":1,"amount":36.66,"amountDiscount":0,"message":"DE 22/12 A 31/12 ( 10 ): R$ 36.66 33.3%"}]}]},{"groupId":19,"groupDescription":"Mensalidade NET VIRTUA +","amount":"102.09","order":"9","extractItems":[{"idExtractItem":1007168359,"idExtractItemType":"400","itemDescription":"MENSALIDADE VIRTUA","installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-01T00:00:00Z","sourceValue":0,"addressComplement":null,"pointId":7459075,"productId":3447,"productDescription":"COMODATO","order":1,"itemGrouper":null,"proportionality":null},{"idExtractItem":1007168365,"idExtractItemType":"400","itemDescription":"MENSALIDADE VIRTUA","installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-01T00:00:00Z","sourceValue":0,"addressComplement":null,"pointId":7459075,"productId":4700,"productDescription":"ACESSO GRATIS","order":1,"itemGrouper":null,"proportionality":null},{"idExtractItem":1007168392,"idExtractItemType":"400","itemDescription":"MENSALIDADE VIRTUA","installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-01T00:00:00Z","sourceValue":87.09,"addressComplement":null,"pointId":7459075,"productId":32425,"productDescription":"VIRTUA 15M FIDELIDADE 32425","order":1,"itemGrouper":null,"proportionality":null},{"idExtractItem":1007168406,"idExtractItemType":"481","itemDescription":"MENS CONTEUDO DIGITAL AVULSO","installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-01T00:00:00Z","sourceValue":7.5,"addressComplement":null,"pointId":null,"productId":41265,"productDescription":"CINE BR","order":1,"itemGrouper":1007168392,"proportionality":null},{"idExtractItem":1007168418,"idExtractItemType":"481","itemDescription":"MENS CONTEUDO DIGITAL AVULSO","installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-01T00:00:00Z","sourceValue":7.5,"addressComplement":null,"pointId":null,"productId":41267,"productDescription":"CINE EURO","order":1,"itemGrouper":1007168392,"proportionality":null}]},{"groupId":23,"groupDescription":"Mensalidade Proporcional VIRTUA +","amount":"-13.26","order":"10","extractItems":[{"idExtractItem":1007168389,"idExtractItemType":"402","itemDescription":"MENS PROPORCIONAL VIRTUA","installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-01T00:00:00Z","sourceValue":-52.25,"addressComplement":null,"pointId":7459075,"productId":32425,"productDescription":"VIRTUA 15M FIDELIDADE 32425","order":3,"itemGrouper":null,"proportionality":[{"entryDate":"2019-12-14T00:00:00Z","finishDate":"2020-01-01T00:00:00Z","quantity":-1,"amount":-52.25,"amountDiscount":0,"message":"DE 14/12 A 31/12 ( 18 ): R$ -61.25 60.0%"}]},{"idExtractItem":1007168493,"idExtractItemType":"481","itemDescription":"MENS CONTEUDO DIGITAL AVULSO","installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-01T00:00:00Z","sourceValue":-4.5,"addressComplement":null,"pointId":null,"productId":41267,"productDescription":"CINE EURO","order":1,"itemGrouper":1007168389,"proportionality":null},{"idExtractItem":1007168495,"idExtractItemType":"481","itemDescription":"MENS CONTEUDO DIGITAL AVULSO","installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-01T00:00:00Z","sourceValue":-4.5,"addressComplement":null,"pointId":null,"productId":41265,"productDescription":"CINE BR","order":1,"itemGrouper":1007168389,"proportionality":null},{"idExtractItem":1007168399,"idExtractItemType":"402","itemDescription":"MENS PROPORCIONAL VIRTUA","installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-01T00:00:00Z","sourceValue":47.99,"addressComplement":null,"pointId":7459075,"productId":53278,"productDescription":"VIRTUA 15M FIDELIDADE 32425","order":3,"itemGrouper":null,"proportionality":[{"entryDate":"2019-12-14T00:00:00Z","finishDate":"2020-01-01T00:00:00Z","quantity":1,"amount":47.99,"amountDiscount":0,"message":"DE 14/12 A 31/12 ( 18 ): R$ 47.99 60.0%"}]}]},{"groupId":38,"groupDescription":"Claro S.A.","amount":"24.9","order":"11","extractItems":[{"idExtractItem":1007168410,"idExtractItemType":"481","itemDescription":"MENS CONTEUDO DIGITAL AVULSO","installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-01T00:00:00Z","sourceValue":7.5,"addressComplement":null,"pointId":null,"productId":41265,"productDescription":"CINE BR","order":1,"itemGrouper":null,"proportionality":null},{"idExtractItem":1007168416,"idExtractItemType":"481","itemDescription":"MENS CONTEUDO DIGITAL AVULSO","installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-01T00:00:00Z","sourceValue":9.9,"addressComplement":null,"pointId":null,"productId":41266,"productDescription":"CINE DOCS","order":1,"itemGrouper":null,"proportionality":null},{"idExtractItem":1007168424,"idExtractItemType":"481","itemDescription":"MENS CONTEUDO DIGITAL AVULSO","installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-01T00:00:00Z","sourceValue":7.5,"addressComplement":null,"pointId":null,"productId":41267,"productDescription":"CINE EURO","order":1,"itemGrouper":null,"proportionality":null}]},{"groupId":25,"groupDescription":"Encargos/Juros/Multas","amount":"4.9","order":"16","extractItems":[{"idExtractItem":994672306,"idExtractItemType":"33","itemDescription":"JUROS PGTO EM ATRASO","installmentNumber":null,"totalInstallments":null,"dueDate":"2019-11-22T00:00:00Z","entryDate":"2019-11-23T00:00:00Z","sourceValue":0.75,"addressComplement":null,"pointId":null,"productId":null,"productDescription":null,"order":2,"itemGrouper":null,"proportionality":[{"entryDate":"2019-11-10T00:00:00Z","finishDate":"2019-11-22T00:00:00Z","quantity":1,"amount":0.75,"amountDiscount":null,"message":"PROP JUROS REFERENTE A DEBITO DE 10/11 A 21/11 ( 11 ): R$ 207,43"}]},{"idExtractItem":994672307,"idExtractItemType":"34","itemDescription":"MULTA ","installmentNumber":null,"totalInstallments":null,"dueDate":"2019-11-22T00:00:00Z","entryDate":"2019-11-23T00:00:00Z","sourceValue":4.15,"addressComplement":null,"pointId":null,"productId":null,"productDescription":null,"order":1,"itemGrouper":null,"proportionality":null}]},{"groupId":28,"groupDescription":"Descontos/Cancelamentos","amount":"-90","order":"19","extractItems":[{"idExtractItem":1003332653,"idExtractItemType":"7","itemDescription":"DESCONTO COMERCIAL VIRTUA","installmentNumber":1,"totalInstallments":null,"dueDate":"2020-01-01T00:00:00Z","entryDate":"2019-12-13T00:00:00Z","sourceValue":-90,"addressComplement":null,"pointId":7459075,"productId":53278,"productDescription":"VIRTUA 35M COM TV E FONE E CONTROLE FID","order":1,"itemGrouper":null,"proportionality":null}]}]},{"partnerId":2,"partnerName":"EMBRATEL","chargeId":120184811,"generationDate":"2019-12-18T15:26:24Z","originalDueDate":"2020-01-10T00:00:00Z","dueDate":"2020-01-10T00:00:00Z","amountCharge":42.81,"amountPaid":null,"balance":42.81,"isExternalCollecting":null,"statusId":9,"status":"NAO EMITIDO","chargeModality":"DEBITO EM CONTA","serviceGroup":[{"groupId":1,"groupDescription":"NET FONE VIA EMBRATEL","partnerServiceId":1,"partnerServiceDescription":"NET FONE VIA EMBRATEL","partnerServiceAmount":42.81,"partnerExtracts":null,"partnerPhones":[{"originTerminal":"1933183384--FRANQUIA 001","amount":42.81,"partnerExtracts":[{"idExtractItem":500483338,"installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-18T19:39:53Z","partnerItemId":123,"partnerItemDescription":"NETFONE MULTI ILIMITADO LOCAL","idExtractItemType":"1052","itemDescription":"NETFONE MULTI ILIMITADO LOCAL","amount":22.63,"isContested":"N","addressComplement":null,"details":[{"idDetExtractItem":3819854136,"sequenceNumber":1,"startDate":"2019-11-12T00:00:00Z","endDate":"2019-12-11T00:00:00Z","startTime":" ","endTime":" ","origin":"IDU SP","destination":null,"destinationCountry":" ","callDuration":1,"callDurationUnit":"UNIDADE","callValue":16.15,"callDetailValue":22.63,"originTerminal":"1933183384--FRANQUIA 001","targetTerminal":null,"taxType":"E","entryDate":"2019-12-18T19:39:53Z"}]},{"idExtractItem":500483350,"installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-18T19:39:54Z","partnerItemId":13,"partnerItemDescription":"LIGACOES LOCAIS RECEBIDAS A COBRAR DE CELULARES","idExtractItemType":"174","itemDescription":"NET FO EBT LC RECE CB CL","amount":20.18,"isContested":"N","addressComplement":null,"details":[{"idDetExtractItem":3819854181,"sequenceNumber":31,"startDate":"2019-11-11T00:00:00Z","endDate":"2019-11-11T00:00:00Z","startTime":"16:48:26","endTime":" ","origin":"IDU SP","destination":"Campinas","destinationCountry":" ","callDuration":1.5,"callDurationUnit":"MINUTO","callValue":1.23,"callDetailValue":1.72,"originTerminal":"1933183384--FRANQUIA 001","targetTerminal":"19989865639","taxType":"E","entryDate":"2019-12-18T19:39:54Z"},{"idDetExtractItem":3819854183,"sequenceNumber":32,"startDate":"2019-11-14T00:00:00Z","endDate":"2019-11-14T00:00:00Z","startTime":"17:47:45","endTime":" ","origin":"IDU SP","destination":"Campinas","destinationCountry":" ","callDuration":0.6,"callDurationUnit":"MINUTO","callValue":0.49,"callDetailValue":0.69,"originTerminal":"1933183384--FRANQUIA 001","targetTerminal":"19989865639","taxType":"E","entryDate":"2019-12-18T19:39:54Z"},{"idDetExtractItem":3819854184,"sequenceNumber":33,"startDate":"2019-11-15T00:00:00Z","endDate":"2019-11-15T00:00:00Z","startTime":"15:17:18","endTime":" ","origin":"IDU SP","destination":"Campinas","destinationCountry":" ","callDuration":1.7,"callDurationUnit":"MINUTO","callValue":1.21,"callDetailValue":1.7,"originTerminal":"1933183384--FRANQUIA 001","targetTerminal":"19995181891","taxType":"E","entryDate":"2019-12-18T19:39:54Z"},{"idDetExtractItem":3819854185,"sequenceNumber":34,"startDate":"2019-11-15T00:00:00Z","endDate":"2019-11-15T00:00:00Z","startTime":"15:20:05","endTime":" ","origin":"IDU SP","destination":"Campinas","destinationCountry":" ","callDuration":0.9,"callDurationUnit":"MINUTO","callValue":0.64,"callDetailValue":0.9,"originTerminal":"1933183384--FRANQUIA 001","targetTerminal":"19995181891","taxType":"E","entryDate":"2019-12-18T19:39:54Z"},{"idDetExtractItem":3819854186,"sequenceNumber":35,"startDate":"2019-11-16T00:00:00Z","endDate":"2019-11-16T00:00:00Z","startTime":"16:27:27","endTime":" ","origin":"IDU SP","destination":"Campinas","destinationCountry":" ","callDuration":1.9,"callDurationUnit":"MINUTO","callValue":1.56,"callDetailValue":2.19,"originTerminal":"1933183384--FRANQUIA 001","targetTerminal":"19989865639","taxType":"E","entryDate":"2019-12-18T19:39:54Z"},{"idDetExtractItem":3819854188,"sequenceNumber":36,"startDate":"2019-11-21T00:00:00Z","endDate":"2019-11-21T00:00:00Z","startTime":"09:03:49","endTime":" ","origin":"IDU SP","destination":"Campinas","destinationCountry":" ","callDuration":4.3,"callDurationUnit":"MINUTO","callValue":3.53,"callDetailValue":4.95,"originTerminal":"1933183384--FRANQUIA 001","targetTerminal":"19989865639","taxType":"E","entryDate":"2019-12-18T19:39:54Z"},{"idDetExtractItem":3819854190,"sequenceNumber":37,"startDate":"2019-11-23T00:00:00Z","endDate":"2019-11-23T00:00:00Z","startTime":"17:01:21","endTime":" ","origin":"IDU SP","destination":"Campinas","destinationCountry":" ","callDuration":0.5,"callDurationUnit":"MINUTO","callValue":0.41,"callDetailValue":0.57,"originTerminal":"1933183384--FRANQUIA 001","targetTerminal":"19995445281","taxType":"E","entryDate":"2019-12-18T19:39:54Z"},{"idDetExtractItem":3819854191,"sequenceNumber":38,"startDate":"2019-11-24T00:00:00Z","endDate":"2019-11-24T00:00:00Z","startTime":"17:04:42","endTime":" ","origin":"IDU SP","destination":"Campinas","destinationCountry":" ","callDuration":1.6,"callDurationUnit":"MINUTO","callValue":1.14,"callDetailValue":1.6,"originTerminal":"1933183384--FRANQUIA 001","targetTerminal":"19995445281","taxType":"E","entryDate":"2019-12-18T19:39:54Z"},{"idDetExtractItem":3819854192,"sequenceNumber":39,"startDate":"2019-12-06T00:00:00Z","endDate":"2019-12-06T00:00:00Z","startTime":"18:13:30","endTime":" ","origin":"IDU SP","destination":"Campinas","destinationCountry":" ","callDuration":1.3,"callDurationUnit":"MINUTO","callValue":1.06,"callDetailValue":1.49,"originTerminal":"1933183384--FRANQUIA 001","targetTerminal":"19989865639","taxType":"E","entryDate":"2019-12-18T19:39:54Z"},{"idDetExtractItem":3819854193,"sequenceNumber":40,"startDate":"2019-12-07T00:00:00Z","endDate":"2019-12-07T00:00:00Z","startTime":"11:10:28","endTime":" ","origin":"IDU SP","destination":"Campinas","destinationCountry":" ","callDuration":2.9,"callDurationUnit":"MINUTO","callValue":2.38,"callDetailValue":3.34,"originTerminal":"1933183384--FRANQUIA 001","targetTerminal":"19989865639","taxType":"E","entryDate":"2019-12-18T19:39:54Z"},{"idDetExtractItem":3819854194,"sequenceNumber":41,"startDate":"2019-12-07T00:00:00Z","endDate":"2019-12-07T00:00:00Z","startTime":"11:55:27","endTime":" ","origin":"IDU SP","destination":"Campinas","destinationCountry":" ","callDuration":0.9,"callDurationUnit":"MINUTO","callValue":0.74,"callDetailValue":1.03,"originTerminal":"1933183384--FRANQUIA 001","targetTerminal":"19989865639","taxType":"E","entryDate":"2019-12-18T19:39:54Z"}]}]}]}],"debtGroup":null},{"partnerId":16,"partnerName":"CLARO","chargeId":120394021,"generationDate":"2019-12-20T15:46:59Z","originalDueDate":"2020-01-10T00:00:00Z","dueDate":"2020-01-10T00:00:00Z","amountCharge":76.75,"amountPaid":null,"balance":76.75,"isExternalCollecting":null,"statusId":9,"status":"NAO EMITIDO","chargeModality":"DEBITO EM CONTA","serviceGroup":[{"groupId":128,"groupDescription":"CLARO","partnerServiceId":128,"partnerServiceDescription":"CLARO","partnerServiceAmount":76.75,"partnerExtracts":[{"idExtractItem":501008937,"installmentNumber":null,"totalInstallments":null,"dueDate":"2020-01-10T00:00:00Z","entryDate":"2019-12-20T15:59:27Z","partnerItemId":82,"partnerItemDescription":"Mensalidade Claro","idExtractItemType":"998","itemDescription":"CLARO","amount":76.75,"isContested":"N","addressComplement":null,"details":[{"idDetExtractItem":3822236833,"sequenceNumber":1,"startDate":null,"endDate":null,"startTime":null,"endTime":null,"origin":null,"destination":null,"destinationCountry":null,"callDuration":1,"callDurationUnit":null,"callValue":76.75,"callDetailValue":76.75,"originTerminal":null,"targetTerminal":null,"taxType":null,"entryDate":"2019-12-20T15:59:35Z"}]}],"partnerPhones":null}],"debtGroup":null}]}}');
                res.setStatusCode(200);
                return res;
            } else {
                System.assert(false, 'unexpected endpoint ' + req.getEndpoint());
                return null;
            }
        }
    }
}